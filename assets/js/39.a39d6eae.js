(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{400:function(t,s,n){"use strict";n.r(s);var a=n(26),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"hybrid"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#hybrid"}},[t._v("#")]),t._v(" Hybrid")]),t._v(" "),n("p",[n("code",[t._v("Hybrid")]),t._v("是"),n("code",[t._v("OpenID Connect")]),t._v("协议中定义授权方式，它结合了"),n("code",[t._v("Authorization code")]),t._v("和"),n("code",[t._v("implicit")]),t._v("两种授权方式。"),n("code",[t._v("Hybrid")]),t._v("授权方式可以通过客户端配置"),n("code",[t._v("ResponseType")]),t._v("属性来选择"),n("code",[t._v("Code/Id Token")]),t._v(", "),n("code",[t._v("Code/Token")]),t._v("或"),n("code",[t._v("Code/Id Token/Token")]),t._v("令牌组合方式，用户在"),n("code",[t._v("Identity Server")]),t._v("认证通过后会返回"),n("code",[t._v("Authorization code")]),t._v("给客户端浏览器，接下来根据客户端配置的"),n("code",[t._v("ResponseType")]),t._v("不同，授权过程也略有区别。"),n("code",[t._v("Hybrid flow")]),t._v("的三种令牌组合都需要"),n("code",[t._v("Authorization code")]),t._v("，因此常用于保护机密客户端。"),n("a",{attrs:{href:"https://github.com/IdentityModel/oidc-client-js/wiki",target:"_blank",rel:"noopener noreferrer"}},[t._v("oidc-client"),n("OutboundLink")],1),t._v("不支持"),n("code",[t._v("Hybrid flow")]),t._v("。")]),t._v(" "),n("h2",{attrs:{id:"_1-identity-server"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-identity-server"}},[t._v("#")]),t._v(" 1. Identity Server")]),t._v(" "),n("p",[t._v("本节我们继续使用"),n("RouterLink",{attrs:{to:"/identity_server/code.html"}},[t._v("Authorization Code")]),t._v("章节中的"),n("a",{attrs:{href:"https://github.com/colin-chang/AuthSamples/tree/main/ColinChang.IdentityServerWithUI",target:"_blank",rel:"noopener noreferrer"}},[t._v("IdentityServer"),n("OutboundLink")],1),t._v("服务。下面我们简单来演示如何进行客户端注册。本节代码已分享到"),n("a",{attrs:{href:"https://github.com/colin-chang/AuthSamples/tree/main/ColinChang.IdentityServerWithUI",target:"_blank",rel:"noopener noreferrer"}},[t._v("Github"),n("OutboundLink")],1),t._v("。")],1),t._v(" "),n("div",{staticClass:"language-csharp line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-csharp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("IEnumerable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" Clients "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("Client")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            ClientId "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HybridMvcClient"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            ClientSecrets "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("Secret")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HybridMvcClient"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Sha256")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            AllowedGrantTypes "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" GrantTypes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Hybrid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            AllowedScopes "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"WeatherApi"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                IdentityServerConstants"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("StandardScopes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OpenId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                IdentityServerConstants"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("StandardScopes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Profile\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            \n            RedirectUris "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://localhost:9000/signin-oidc"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            FrontChannelLogoutUri "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://localhost:9000/signout-oidc"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            PostLogoutRedirectUris "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://localhost:9000/signout-callback-oidc"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            AllowOfflineAccess "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            RequirePkce "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 关闭 authorization code请求过程验证proof key")]),t._v("\n            AlwaysIncludeUserClaimsInIdToken "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在IdToken中包含所有用户身份声明")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br")])]),n("h2",{attrs:{id:"_2-client"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-client"}},[t._v("#")]),t._v(" 2. Client")]),t._v(" "),n("p",[t._v("这里"),n("a",{attrs:{href:"https://github.com/colin-chang/AuthSamples/tree/main/ColinChang.IdentityServer.Api",target:"_blank",rel:"noopener noreferrer"}},[t._v("API项目"),n("OutboundLink")],1),t._v("依然使用"),n("RouterLink",{attrs:{to:"/identity_server/cc.html#_2-api"}},[t._v("Client Credentials")]),t._v("中的代码，不再赘述。")],1),t._v(" "),n("p",[t._v("这里我们建立一个Asp.Net Core MVC程序作为客户端，客户端代码已共享至"),n("a",{attrs:{href:"https://github.com/colin-chang/AuthSamples/tree/main/ColinChang.IdentityServer.HybridMvcClient",target:"_blank",rel:"noopener noreferrer"}},[t._v("Github"),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("div",{staticClass:"language-csharp line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-csharp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token return-type class-name"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ConfigureServices")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IServiceCollection")]),t._v(" services"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    services"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("AddControllersWithViews")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    JwtSecurityTokenHandler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DefaultInboundClaimTypeMap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Clear")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" is4Configuration "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Configuration"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetSection")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("nameof")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IdentityServerOptions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    services"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token generic-method"}},[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Configure")]),n("span",{pre:!0,attrs:{class:"token generic class-name"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("IdentityServerOptions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("is4Configuration"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" is4Options "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" is4Configuration"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token generic-method"}},[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get")]),n("span",{pre:!0,attrs:{class:"token generic class-name"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("IdentityServerOptions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    services\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("AddAuthentication")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DefaultScheme "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" CookieAuthenticationDefaults"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AuthenticationScheme"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DefaultChallengeScheme "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" OpenIdConnectDefaults"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AuthenticationScheme"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("AddCookie")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CookieAuthenticationDefaults"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AuthenticationScheme"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("AddOpenIdConnect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("OpenIdConnectDefaults"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AuthenticationScheme"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Authority "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" is4Options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ClientId "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" is4Options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ClientId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ClientSecret "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" is4Options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ClientSecret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ResponseType "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" OidcConstants"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ResponseTypes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CodeIdToken"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SaveTokens "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RequireHttpsMetadata "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Scope"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Clear")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("foreach")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" scope "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" is4Options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Scopes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Scope"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Add")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("scope"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SignInScheme "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" CookieAuthenticationDefaults"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AuthenticationScheme"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 添加 claims 从忽略列表中移除等同于添加 ")]),t._v("\n            options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ClaimActions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Remove")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nbf"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ClaimActions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Remove")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"exp"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 移除 claims")]),t._v("\n            options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ClaimActions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("DeleteClaim")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sid"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ClaimActions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("DeleteClaim")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sub"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br"),n("span",{staticClass:"line-number"},[t._v("36")]),n("br"),n("span",{staticClass:"line-number"},[t._v("37")]),n("br"),n("span",{staticClass:"line-number"},[t._v("38")]),n("br"),n("span",{staticClass:"line-number"},[t._v("39")]),n("br"),n("span",{staticClass:"line-number"},[t._v("40")]),n("br")])]),n("p",[n("code",[t._v("Hybrid")]),t._v("客户端配置除了"),n("code",[t._v("ResponseType")]),t._v("属性其它配置与"),n("code",[t._v("Authorization code")]),t._v("完全一致，不再赘述。")]),t._v(" "),n("p",[n("code",[t._v("Hybrid")]),t._v("访问"),n("code",[t._v("Identity data")]),t._v("和"),n("code",[t._v("API")]),t._v("资源，刷新令牌，注销登录等行为方式也与"),n("code",[t._v("Authorization code")]),t._v("完全一致，亦不再赘述。")]),t._v(" "),n("h2",{attrs:{id:"_3-claims"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-claims"}},[t._v("#")]),t._v(" 3. Claims")]),t._v(" "),n("p",[n("code",[t._v("Identity Server")]),t._v("在用户认证后返回的"),n("code",[t._v("Token/Id Token")]),t._v("中包含的了认证的"),n("code",[t._v("Claims")]),t._v("。默认情况直接访问"),n("code",[t._v("User.Claims")]),t._v("只能拿到部分"),n("code",[t._v("Claims")]),t._v("，那是因为框架默认选择了部分"),n("code",[t._v("Claims")]),t._v("映射到"),n("code",[t._v("User.Claims")]),t._v("对象。")]),t._v(" "),n("p",[t._v("如有需要，开发者也可以手动添加或移除特定"),n("code",[t._v("Claims")]),t._v("，具体参见客户端"),n("code",[t._v("33-38")]),t._v("行代码。")]),t._v(" "),n("p",[t._v("如果要将用户"),n("code",[t._v("Claims")]),t._v("包含在Id Token中返回，可以在"),n("code",[t._v("Identity Server")]),t._v("注册客户端时设置\n"),n("code",[t._v("AlwaysIncludeUserClaimsInIdToken = true")]),t._v("。")])])}),[],!1,null,null,null);s.default=e.exports}}]);