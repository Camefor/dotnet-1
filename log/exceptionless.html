<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Exceptionless | .Net 实战笔记</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="https://i.loli.net/2020/02/25/AOjBhkIxtb8dRgl.png">
    <meta name="description" content="熟知.NET Core核心组件设计原理;基于DDD开发云原生微服务应用;掌握.NET Core工程设计最佳实践;提升K8s微服务部署与维护技能">
    
    <link rel="preload" href="/dotnet/assets/css/0.styles.7248ee20.css" as="style"><link rel="preload" href="/dotnet/assets/js/app.4e9b76c2.js" as="script"><link rel="preload" href="/dotnet/assets/js/2.86915a18.js" as="script"><link rel="preload" href="/dotnet/assets/js/46.527ac987.js" as="script"><link rel="prefetch" href="/dotnet/assets/js/10.7f9feb78.js"><link rel="prefetch" href="/dotnet/assets/js/11.43be2bc7.js"><link rel="prefetch" href="/dotnet/assets/js/12.e8c0fca4.js"><link rel="prefetch" href="/dotnet/assets/js/13.08e3036f.js"><link rel="prefetch" href="/dotnet/assets/js/14.6424aec3.js"><link rel="prefetch" href="/dotnet/assets/js/15.4d39118d.js"><link rel="prefetch" href="/dotnet/assets/js/16.e2287734.js"><link rel="prefetch" href="/dotnet/assets/js/17.82266a75.js"><link rel="prefetch" href="/dotnet/assets/js/18.e3676b0a.js"><link rel="prefetch" href="/dotnet/assets/js/19.d7bd221d.js"><link rel="prefetch" href="/dotnet/assets/js/20.b8cf0f4e.js"><link rel="prefetch" href="/dotnet/assets/js/21.c5bcd1a9.js"><link rel="prefetch" href="/dotnet/assets/js/22.6fc7c7b2.js"><link rel="prefetch" href="/dotnet/assets/js/23.6c8b869e.js"><link rel="prefetch" href="/dotnet/assets/js/24.a831f9ed.js"><link rel="prefetch" href="/dotnet/assets/js/25.62b16105.js"><link rel="prefetch" href="/dotnet/assets/js/26.d88ba3e3.js"><link rel="prefetch" href="/dotnet/assets/js/27.f420e029.js"><link rel="prefetch" href="/dotnet/assets/js/28.fb34a308.js"><link rel="prefetch" href="/dotnet/assets/js/29.2490c8c9.js"><link rel="prefetch" href="/dotnet/assets/js/3.20bab2d8.js"><link rel="prefetch" href="/dotnet/assets/js/30.7b53e293.js"><link rel="prefetch" href="/dotnet/assets/js/31.97da4974.js"><link rel="prefetch" href="/dotnet/assets/js/32.6d3ad1a3.js"><link rel="prefetch" href="/dotnet/assets/js/33.3da29db6.js"><link rel="prefetch" href="/dotnet/assets/js/34.089e1fb3.js"><link rel="prefetch" href="/dotnet/assets/js/35.5f60b6ee.js"><link rel="prefetch" href="/dotnet/assets/js/36.cc872073.js"><link rel="prefetch" href="/dotnet/assets/js/37.e1ebcf4e.js"><link rel="prefetch" href="/dotnet/assets/js/38.bab59cca.js"><link rel="prefetch" href="/dotnet/assets/js/39.a39d6eae.js"><link rel="prefetch" href="/dotnet/assets/js/4.1363a917.js"><link rel="prefetch" href="/dotnet/assets/js/40.fae7fbb6.js"><link rel="prefetch" href="/dotnet/assets/js/41.5c5ffdf9.js"><link rel="prefetch" href="/dotnet/assets/js/42.0968c3b8.js"><link rel="prefetch" href="/dotnet/assets/js/43.e0cdc7be.js"><link rel="prefetch" href="/dotnet/assets/js/44.597b492a.js"><link rel="prefetch" href="/dotnet/assets/js/45.5e800e70.js"><link rel="prefetch" href="/dotnet/assets/js/47.6e336667.js"><link rel="prefetch" href="/dotnet/assets/js/48.5cf812b1.js"><link rel="prefetch" href="/dotnet/assets/js/49.f3403fdb.js"><link rel="prefetch" href="/dotnet/assets/js/5.e6eb57b9.js"><link rel="prefetch" href="/dotnet/assets/js/50.53f4771b.js"><link rel="prefetch" href="/dotnet/assets/js/51.a4151538.js"><link rel="prefetch" href="/dotnet/assets/js/52.0e39eecc.js"><link rel="prefetch" href="/dotnet/assets/js/53.7fefff6f.js"><link rel="prefetch" href="/dotnet/assets/js/54.e11d2956.js"><link rel="prefetch" href="/dotnet/assets/js/55.77862968.js"><link rel="prefetch" href="/dotnet/assets/js/56.031c2977.js"><link rel="prefetch" href="/dotnet/assets/js/57.e1f250f4.js"><link rel="prefetch" href="/dotnet/assets/js/58.f84112be.js"><link rel="prefetch" href="/dotnet/assets/js/59.771eb349.js"><link rel="prefetch" href="/dotnet/assets/js/6.a9924f8b.js"><link rel="prefetch" href="/dotnet/assets/js/7.da95d574.js"><link rel="prefetch" href="/dotnet/assets/js/8.c208d4c3.js"><link rel="prefetch" href="/dotnet/assets/js/9.4de8d1ac.js">
    <link rel="stylesheet" href="/dotnet/assets/css/0.styles.7248ee20.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/dotnet/" class="home-link router-link-active"><!----> <span class="site-name">.Net 实战笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/dotnet/basic/introduction.html" class="nav-link">
  Get Start
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Books" class="dropdown-title"><span class="title">Books</span> <span class="arrow down"></span></button> <button type="button" aria-label="Books" class="mobile-dropdown-title"><span class="title">Books</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://ccstudio.com.cn/python" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Python
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://ccstudio.com.cn/linux" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Linux
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://ccstudio.com.cn/architecture" target="_blank" rel="noopener noreferrer" class="nav-link external">
  系统架构设计
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://ccstudio.com.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/colin-chang/dotnet" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/dotnet/basic/introduction.html" class="nav-link">
  Get Start
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Books" class="dropdown-title"><span class="title">Books</span> <span class="arrow down"></span></button> <button type="button" aria-label="Books" class="mobile-dropdown-title"><span class="title">Books</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://ccstudio.com.cn/python" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Python
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://ccstudio.com.cn/linux" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Linux
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://ccstudio.com.cn/architecture" target="_blank" rel="noopener noreferrer" class="nav-link external">
  系统架构设计
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://ccstudio.com.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/colin-chang/dotnet" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>.Net基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>依赖注入</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>文件系统</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>配置选项</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>日志框架</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dotnet/log/framework.html" class="sidebar-link">日志框架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dotnet/log/framework.html#_1-日志对象" class="sidebar-link">1. 日志对象</a></li><li class="sidebar-sub-header"><a href="/dotnet/log/framework.html#_2-日志模型" class="sidebar-link">2. 日志模型</a></li><li class="sidebar-sub-header"><a href="/dotnet/log/framework.html#_3-ilogger" class="sidebar-link">3. ILogger</a></li><li class="sidebar-sub-header"><a href="/dotnet/log/framework.html#_4-依赖注入" class="sidebar-link">4. 依赖注入</a></li><li class="sidebar-sub-header"><a href="/dotnet/log/framework.html#_5-日志范围" class="sidebar-link">5. 日志范围</a></li><li class="sidebar-sub-header"><a href="/dotnet/log/framework.html#_6-日志过滤" class="sidebar-link">6. 日志过滤</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dotnet/log/framework.html#_6-1-setminimumlevel" class="sidebar-link">6.1 SetMinimumLevel</a></li><li class="sidebar-sub-header"><a href="/dotnet/log/framework.html#_6-2-addfilter" class="sidebar-link">6.2 AddFilter</a></li><li class="sidebar-sub-header"><a href="/dotnet/log/framework.html#_6-3-配置文件" class="sidebar-link">6.3 配置文件</a></li></ul></li><li class="sidebar-sub-header"><a href="/dotnet/log/framework.html#_7-loggermessage" class="sidebar-link">7. LoggerMessage</a></li><li class="sidebar-sub-header"><a href="/dotnet/log/framework.html#_8-第三方日志组件" class="sidebar-link">8. 第三方日志组件</a></li></ul></li><li><a href="/dotnet/log/elk.html" class="sidebar-link">ELK</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dotnet/log/elk.html#_1-简介" class="sidebar-link">1. 简介</a></li><li class="sidebar-sub-header"><a href="/dotnet/log/elk.html#_2-elk环境搭建" class="sidebar-link">2. ELK环境搭建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dotnet/log/elk.html#_2-1-clone-repository" class="sidebar-link">2.1 Clone Repository</a></li><li class="sidebar-sub-header"><a href="/dotnet/log/elk.html#_2-2-logstash-configuration" class="sidebar-link">2.2 Logstash Configuration</a></li><li class="sidebar-sub-header"><a href="/dotnet/log/elk.html#_2-3-启动-停止-elk" class="sidebar-link">2.3 启动/停止 ELK</a></li></ul></li><li class="sidebar-sub-header"><a href="/dotnet/log/elk.html#_3-记录日志" class="sidebar-link">3. 记录日志</a></li><li class="sidebar-sub-header"><a href="/dotnet/log/elk.html#_4-查看日志" class="sidebar-link">4. 查看日志</a></li></ul></li><li><a href="/dotnet/log/exceptionless.html" aria-current="page" class="active sidebar-link">Exceptionless</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dotnet/log/exceptionless.html#_1-简介" class="sidebar-link">1. 简介</a></li><li class="sidebar-sub-header"><a href="/dotnet/log/exceptionless.html#_2-简单使用" class="sidebar-link">2. 简单使用</a></li><li class="sidebar-sub-header"><a href="/dotnet/log/exceptionless.html#_3-进阶使用" class="sidebar-link">3. 进阶使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dotnet/log/exceptionless.html#_3-1-发送事件" class="sidebar-link">3.1 发送事件</a></li><li class="sidebar-sub-header"><a href="/dotnet/log/exceptionless.html#_3-2-手动发送异常" class="sidebar-link">3.2 手动发送异常</a></li><li class="sidebar-sub-header"><a href="/dotnet/log/exceptionless.html#_3-3-附加标记" class="sidebar-link">3.3 附加标记</a></li><li class="sidebar-sub-header"><a href="/dotnet/log/exceptionless.html#_3-4-统一处理发送的事件" class="sidebar-link">3.4 统一处理发送的事件</a></li><li class="sidebar-sub-header"><a href="/dotnet/log/exceptionless.html#_3-5-配合使用-nlog-或-log4net" class="sidebar-link">3.5 配合使用 NLog 或 Log4Net</a></li></ul></li><li class="sidebar-sub-header"><a href="/dotnet/log/exceptionless.html#_4-异常日志模块封装" class="sidebar-link">4. 异常日志模块封装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dotnet/log/exceptionless.html#_4-1-异常日志模块" class="sidebar-link">4.1 异常日志模块</a></li><li class="sidebar-sub-header"><a href="/dotnet/log/exceptionless.html#_4-2-异常日志记录" class="sidebar-link">4.2 异常日志记录</a></li></ul></li><li class="sidebar-sub-header"><a href="/dotnet/log/exceptionless.html#_5-本地部署" class="sidebar-link">5. 本地部署</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>承载系统</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>管道</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>静态文件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>路由</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>异常处理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>缓存</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>会话</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>认证授权</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>IdentityServer</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据访问</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>WebAPI</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>跨域资源共享</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>本地化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>健康检查</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其它主题</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="exceptionless"><a href="#exceptionless" class="header-anchor">#</a> Exceptionless</h1> <h2 id="_1-简介"><a href="#_1-简介" class="header-anchor">#</a> 1. 简介</h2> <p>Exceptionless 是一个免费开源分布式系统日志收集框架，它可以应用在基于 ASP.NET，ASP.NET Core，Web Api，Web Forms，WPF，Console，MVC 等技术栈的应用程序中，并且提供了Rest接口可以应用在 Javascript，Node.js 中。它将日志收集变得简单易用并且不需要了解太多的相关技术细节及配置。</p> <p>在以前，我们做日志收集大多使用 Log4net，Nlog 等框架，在应用程序变得复杂并且集群的时候，可能传统的方式已经不是很好的适用了，因为收集各个日志并且分析他们将变得麻烦而且浪费时间。</p> <p>现在Exceptionless团队给我们提供了一个更好的框架来做这件事情，我认为这是非常伟大并且有意义的，感谢他们。</p> <p>官网：http://exceptionless.com/
GitHub：https://github.com/exceptionless/Exceptionless</p> <p>两种使用方式 :</p> <ol><li>官网创建帐号，并新建应用程序以及项目，然后生成apikey（数据存储在Exceptionless）</li> <li>自己搭建Exceptionless的环境，部署在本地（数据存储在本地）</li></ol> <h2 id="_2-简单使用"><a href="#_2-简单使用" class="header-anchor">#</a> 2. 简单使用</h2> <h4 id="_1-注册账号"><a href="#_1-注册账号" class="header-anchor">#</a> 1) 注册账号</h4> <p>首先，需要去官网注册一个帐号（打不开的同学你懂的），注册完成之后登录系统。
<img src="https://i.loli.net/2020/02/25/UWvlZmKobYrIVgh.png" alt="注册账号"></p> <h4 id="_2-新建项目"><a href="#_2-新建项目" class="header-anchor">#</a> 2) 新建项目</h4> <p>按照提示，添加一个项目。</p> <p><img src="https://i.loli.net/2020/02/25/eQkFhyVWdrwlMHb.png" alt="新建项目"></p> <p>选择项目的类型，可以看到 Exceptionless支持很多种项目。我们来选择一个 ASP.NET Core 的项目。</p> <p><img src="https://i.loli.net/2020/02/25/NwtLR8HKBZ1gcQS.png" alt="选择项目类型"></p> <p>完成后可以看到一个详细步骤说明如何在项目中集成。</p> <p><img src="https://i.loli.net/2020/02/25/hD1c2lbYJK4wRqz.png" alt="nuget"></p> <h4 id="_3-项目集成"><a href="#_3-项目集成" class="header-anchor">#</a> 3) 项目集成</h4> <ul><li>首先，使用 NuGet 添加一个包，名字叫<code>Exceptionless.AspNetCore</code>。</li> <li>在 ASP.NET Core 项目中，打开<code>startup.cs</code>文件，找到<code>Configure()</code>方法，添加如下：<div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Exceptionless</span><span class="token punctuation">;</span>
<span class="token range operator">..</span><span class="token range operator">..</span><span class="token range operator">..</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">,</span> <span class="token class-name">IHostingEnvironment</span> env<span class="token punctuation">,</span> <span class="token class-name">ILoggerFactory</span> loggerFactory<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// xxxxx 处填写上图画红线部分的key</span>
    app<span class="token punctuation">.</span><span class="token function">UseExceptionless</span><span class="token punctuation">(</span><span class="token string">&quot;xxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">UseMvc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ul> <p>至此，Exceptionless 已经可以在你的项目中工作了，它会自动记录项目中的异常情况。</p> <h4 id="_4-查看异常"><a href="#_4-查看异常" class="header-anchor">#</a> 4) 查看异常</h4> <p>创建一个 ASP.NET Core 项目，然后通过下面方式直接抛出一个异常，下面我们来运行一下，看看它是怎么工作的吧。</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">About</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span><span class="token string">&quot;test exception&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>接下来，刷新 Exceptionless的页面，在 Dashboard 主面板中，可以看到关于整个项目的一个异常情况，并且分别以几种方式列了出来，其中包括分布图，最频繁的异常，最近的异常等等。</p> <p><img src="https://i.loli.net/2020/02/25/UuIVhtvCGTesZnq.png" alt="Exceptionless控制台"></p> <p>这个我们刚才在Abount Action中制造的一个异常，Exceptionless已经记录了下来，点进去之后可以看一下详情。</p> <p><img src="https://i.loli.net/2020/02/25/QukSHIMOJYn3AVy.png" alt="异常总揽"> <img src="https://i.loli.net/2020/02/25/JZGabQRoCNv4zqn.png" alt="异常详情"></p> <p>除了一些基本的异常类型、时间和堆栈外，Request和Enviroment中还包括访问者的坐标、IP地址、发生异常的URL地址、浏览器信息，操作系统、甚至发生异常时请求的Cookie值。</p> <h2 id="_3-进阶使用"><a href="#_3-进阶使用" class="header-anchor">#</a> 3. 进阶使用</h2> <h3 id="_3-1-发送事件"><a href="#_3-1-发送事件" class="header-anchor">#</a> 3.1 发送事件</h3> <p>除了我们所熟悉的异常信息外，Exceptionless 还可以记录很多种类的其它信息，这些信息统称做事件(Event)。</p> <p>在Exceptionless 中，有这几类事件： Log （日志）、Feature Usages（功能用途）、404、Custom Event（自定义事件）。</p> <p>Exceptionless 中发送不同类型事件很简单，代码如下：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Exceptionless</span><span class="token punctuation">;</span>

<span class="token comment">// 发送日志</span>
ExceptionlessClient<span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">SubmitLog</span><span class="token punctuation">(</span><span class="token string">&quot;Logging made easy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 你可以指定日志来源，和日志级别。</span>
<span class="token comment">// 日志级别有这几种: Trace, Debug, Info, Warn, Error</span>
ExceptionlessClient<span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">SubmitLog</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Program</span><span class="token punctuation">)</span><span class="token punctuation">.</span>FullName<span class="token punctuation">,</span> <span class="token string">&quot;This is so easy&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ExceptionlessClient<span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">CreateLog</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Program</span><span class="token punctuation">)</span><span class="token punctuation">.</span>FullName<span class="token punctuation">,</span> <span class="token string">&quot;This is so easy&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddTags</span><span class="token punctuation">(</span><span class="token string">&quot;Exceptionless&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 发送 Feature Usages</span>
ExceptionlessClient<span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">SubmitFeatureUsage</span><span class="token punctuation">(</span><span class="token string">&quot;MyFeature&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ExceptionlessClient<span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">CreateFeatureUsage</span><span class="token punctuation">(</span><span class="token string">&quot;MyFeature&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddTags</span><span class="token punctuation">(</span><span class="token string">&quot;Exceptionless&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 发送一个 404</span>
ExceptionlessClient<span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">SubmitNotFound</span><span class="token punctuation">(</span><span class="token string">&quot;/somepage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ExceptionlessClient<span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">CreateNotFound</span><span class="token punctuation">(</span><span class="token string">&quot;/somepage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddTags</span><span class="token punctuation">(</span><span class="token string">&quot;Exceptionless&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 发生一个自定义事件</span>
ExceptionlessClient<span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">SubmitEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Event</span> <span class="token punctuation">{</span> Message <span class="token operator">=</span> <span class="token string">&quot;Low Fuel&quot;</span><span class="token punctuation">,</span> Type <span class="token operator">=</span> <span class="token string">&quot;racecar&quot;</span><span class="token punctuation">,</span> Source <span class="token operator">=</span> <span class="token string">&quot;Fuel System&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_3-2-手动发送异常"><a href="#_3-2-手动发送异常" class="header-anchor">#</a> 3.2 手动发送异常</h3> <p>有时候，我们在程序代码中显式的处理一些异常，这个时候可以手动的来将一些异常信息发送到Exceptionless。</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">try</span> 
<span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ApplicationException</span><span class="token punctuation">(</span>Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    ex<span class="token punctuation">.</span><span class="token function">ToExceptionless</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_3-3-附加标记"><a href="#_3-3-附加标记" class="header-anchor">#</a> 3.3 附加标记</h3> <p>当然你还可以为发送的事件添加额外的标记信息，比如坐标，标签，以及其它的用户相关的信息等。</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">try</span> 
<span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ApplicationException</span><span class="token punctuation">(</span><span class="token string">&quot;Unable to create order from quote.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    ex<span class="token punctuation">.</span><span class="token function">ToExceptionless</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 为事件设定一个编号，以便于你搜索 </span>
        <span class="token punctuation">.</span><span class="token function">SetReferenceId</span><span class="token punctuation">(</span>Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">&quot;N&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">// 添加一个不包含CreditCardNumber属性的对象信息</span>
        <span class="token punctuation">.</span><span class="token function">AddObject</span><span class="token punctuation">(</span>order<span class="token punctuation">,</span> <span class="token string">&quot;Order&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">excludedPropertyNames</span><span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">&quot;CreditCardNumber&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">maxDepth</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token comment">// 设置一个名为&quot;Quote&quot;的编号</span>
        <span class="token punctuation">.</span><span class="token function">SetProperty</span><span class="token punctuation">(</span><span class="token string">&quot;Quote&quot;</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span>
        <span class="token comment">// 添加一个名为“Order”的标签</span>
        <span class="token punctuation">.</span><span class="token function">AddTags</span><span class="token punctuation">(</span><span class="token string">&quot;Order&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">// 标记为关键异常</span>
        <span class="token punctuation">.</span><span class="token function">MarkAsCritical</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 设置一个地理位置坐标</span>
        <span class="token punctuation">.</span><span class="token function">SetGeo</span><span class="token punctuation">(</span><span class="token number">43.595089</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">88.444602</span><span class="token punctuation">)</span>
        <span class="token comment">// 设置触发异常的用户信息</span>
        <span class="token punctuation">.</span><span class="token function">SetUserIdentity</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> user<span class="token punctuation">.</span>FullName<span class="token punctuation">)</span>
        <span class="token comment">// 设置触发用户的一些描述</span>
        <span class="token punctuation">.</span><span class="token function">SetUserDescription</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>EmailAddress<span class="token punctuation">,</span> <span class="token string">&quot;I tried creating an order from my saved quote.&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">// 发送事件</span>
        <span class="token punctuation">.</span><span class="token function">Submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="_3-4-统一处理发送的事件"><a href="#_3-4-统一处理发送的事件" class="header-anchor">#</a> 3.4 统一处理发送的事件</h3> <p>可以在通过SubmittingEvent 事件设置全局的忽略异常信息添加一些自定义信息等。</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>
<span class="token preprocessor property">#<span class="token directive keyword">region</span> Exceptionless配置</span>
    ExceptionlessClient<span class="token punctuation">.</span>Default<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span>ApiKey <span class="token operator">=</span> exceptionlessOptions<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>ApiKey<span class="token punctuation">;</span>
    ExceptionlessClient<span class="token punctuation">.</span>Default<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span>ServerUrl <span class="token operator">=</span> exceptionlessOptions<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>ServerUrl<span class="token punctuation">;</span>
    ExceptionlessClient<span class="token punctuation">.</span>Default<span class="token punctuation">.</span>SubmittingEvent <span class="token operator">+=</span> OnSubmittingEvent<span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">UseExceptionless</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>

 <span class="token comment">/// &lt;summary&gt;</span>
<span class="token comment">/// 全局配置Exceptionless</span>
<span class="token comment">/// &lt;/summary&gt;</span>
<span class="token comment">/// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;</span>
<span class="token comment">/// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;</span>
<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnSubmittingEvent</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventSubmittingEventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 只处理未处理的异常</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>e<span class="token punctuation">.</span>IsUnhandledError<span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token comment">// 忽略404错误</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>Event<span class="token punctuation">.</span><span class="token function">IsNotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span>Cancel <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 忽略没有错误体的错误</span>
    <span class="token class-name"><span class="token keyword">var</span></span> error <span class="token operator">=</span> e<span class="token punctuation">.</span>Event<span class="token punctuation">.</span><span class="token function">GetError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token comment">// 忽略 401 (Unauthorized) 和 请求验证的错误.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>Code <span class="token operator">==</span> <span class="token string">&quot;401&quot;</span> <span class="token operator">||</span> error<span class="token punctuation">.</span>Type <span class="token operator">==</span> <span class="token string">&quot;System.Web.HttpRequestValidationException&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span>Cancel <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Ignore any exceptions that were not thrown by our code.</span>
    <span class="token class-name"><span class="token keyword">var</span></span> handledNamespaces <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span> <span class="token string">&quot;Exceptionless&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>error<span class="token punctuation">.</span>StackTrace<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>DeclaringNamespace<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span>ns <span class="token operator">=&gt;</span> handledNamespaces<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span>ns<span class="token punctuation">.</span>Contains<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span>Cancel <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 添加附加信息.</span>
    <span class="token comment">//e.Event.AddObject(order, &quot;Order&quot;, excludedPropertyNames: new[] { &quot;CreditCardNumber&quot; }, maxDepth: 2);</span>
    e<span class="token punctuation">.</span>Event<span class="token punctuation">.</span>Tags<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;MunicipalPublicCenter.BusinessApi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    e<span class="token punctuation">.</span>Event<span class="token punctuation">.</span><span class="token function">MarkAsCritical</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//e.Event.SetUserIdentity();</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><h3 id="_3-5-配合使用-nlog-或-log4net"><a href="#_3-5-配合使用-nlog-或-log4net" class="header-anchor">#</a> 3.5 配合使用 NLog 或 Log4Net</h3> <p>配合使用 NLog 或 Log4Net
有时候，程序中需要对日志信息做非常详细的记录，比如在开发阶段。这个时候可以配合 log4net 或者 nlog 来联合使用 exceptionless，详细可以查看这个官方的 [示例][https://github.com/exceptionless/Exceptionless.Net/tree/master/samples/Exceptionless.SampleConsole]。</p> <p>如果你的程序中有在短时间内生成大量日志的情况，比如一分钟产生上千的日志。这个时候你需要使用内存存储（in-memory store）事件，这样客户端就不会将事件系列化的磁盘，所以会快很多。这样就可以使用Log4net 或者 Nlog来将一些事件存储到磁盘，另外 Exceptionless 事件存储到内存当中。</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Exceptionless</span><span class="token punctuation">;</span>
ExceptionlessClient<span class="token punctuation">.</span>Default<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span><span class="token function">UseInMemoryStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_4-异常日志模块封装"><a href="#_4-异常日志模块封装" class="header-anchor">#</a> 4. 异常日志模块封装</h2> <p>下面是实际项目(Asp.Net Core)中使用Exceptionless异常日志模块的简单封装。</p> <p>简单说明下。在项目中许多可以预料的异常，如文件IO，网络请求等，这些异常我们一般都会通过<code>try...catch...</code>方式捕获，由于此类异常属于预料中异常，我们只记录日志(Exceptionless Log)即可。对于程序中出现的未处理异常则属于预料之外的错误，比如编写代码时的逻辑错误等，此类异常我们通过全局异常过滤器捕捉到并发送到Exceptionless的异常中。</p> <p>其异常严重程度链如下：</p> <p><code>TraceLog/OtherLog &lt; DebugLog &lt; InfoLog &lt; WarnLog &lt; ErrorLog &lt; FatalLog &lt; Exception</code></p> <h3 id="_4-1-异常日志模块"><a href="#_4-1-异常日志模块" class="header-anchor">#</a> 4.1 异常日志模块</h3> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Exceptionless</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Exceptionless<span class="token punctuation">.</span>Logging</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ExceptionlessUtil</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Trace</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">Trace</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Trace</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> title <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> traceException <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">TraceLog</span><span class="token punctuation">(</span>ex<span class="token punctuation">,</span> LogLevel<span class="token punctuation">.</span>Trace<span class="token punctuation">,</span> title<span class="token punctuation">,</span> traceException<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Debug</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">Debug</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Debug</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> title <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> traceException <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">TraceLog</span><span class="token punctuation">(</span>ex<span class="token punctuation">,</span> LogLevel<span class="token punctuation">.</span>Debug<span class="token punctuation">,</span> title<span class="token punctuation">,</span> traceException<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Info</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">Info</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Info</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> title <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> traceException <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">TraceLog</span><span class="token punctuation">(</span>ex<span class="token punctuation">,</span> LogLevel<span class="token punctuation">.</span>Info<span class="token punctuation">,</span> title<span class="token punctuation">,</span> traceException<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Warn</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">Warn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Warn</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> title <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> traceException <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">TraceLog</span><span class="token punctuation">(</span>ex<span class="token punctuation">,</span> LogLevel<span class="token punctuation">.</span>Warn<span class="token punctuation">,</span> title<span class="token punctuation">,</span> traceException<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">Error</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> title <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> traceException <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">TraceLog</span><span class="token punctuation">(</span>ex<span class="token punctuation">,</span> LogLevel<span class="token punctuation">.</span>Error<span class="token punctuation">,</span> title<span class="token punctuation">,</span> traceException<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> title <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> traceException <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">TraceLog</span><span class="token punctuation">(</span>ex<span class="token punctuation">,</span> LogLevel<span class="token punctuation">.</span>Fatal<span class="token punctuation">,</span> title<span class="token punctuation">,</span> traceException<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Other</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">Other</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Other</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> title <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> traceException <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">TraceLog</span><span class="token punctuation">(</span>ex<span class="token punctuation">,</span> LogLevel<span class="token punctuation">.</span>Other<span class="token punctuation">,</span> title<span class="token punctuation">,</span> traceException<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 记录Log</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;param name=&quot;ex&quot;&gt;异常&lt;/param&gt;</span>
    <span class="token comment">/// &lt;param name=&quot;logLevel&quot;&gt;日志级别&lt;/param&gt;</span>
    <span class="token comment">/// &lt;param name=&quot;traceException&quot;&gt;是否追踪异常。true则提交Exception,否则只提交Log&lt;/param&gt;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">TraceLog</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">,</span> <span class="token class-name">LogLevel</span> logLevel<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> title <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> traceException <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        ExceptionlessClient<span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">CreateLog</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>TargetSite<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>FullName<span class="token punctuation">,</span>
                <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span> <span class="token punctuation">?</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty <span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">title</span><span class="token punctuation">}</span></span><span class="token string">,错误消息:&quot;</span></span> <span class="token operator">+</span> ex<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> logLevel<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">AddTags</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>FullName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>traceException<span class="token punctuation">)</span>
            <span class="token function">TraceException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 追踪Exception</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;param name=&quot;ex&quot;&gt;&lt;/param&gt;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">TraceException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        ex<span class="token punctuation">.</span><span class="token function">ToExceptionless</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br></div></div><h3 id="_4-2-异常日志记录"><a href="#_4-2-异常日志记录" class="header-anchor">#</a> 4.2 异常日志记录</h3> <h5 id="_1-异常过滤"><a href="#_1-异常过滤" class="header-anchor">#</a> 1) 异常过滤</h5> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>
<span class="token comment">/// &lt;summary&gt;</span>
<span class="token comment">/// 全局异常过滤器</span>
<span class="token comment">/// &lt;/summary&gt;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalExceptionFilter</span><span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">IExceptionFilter</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnException</span><span class="token punctuation">(</span><span class="token class-name">ExceptionContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//提交异常信息</span>
        ExceptionlessUtil<span class="token punctuation">.</span><span class="token function">TraceException</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Exception<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//转到错误页面</span>
        context<span class="token punctuation">.</span>Result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RedirectResult</span><span class="token punctuation">(</span><span class="token string">&quot;/error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span>HttpContext<span class="token punctuation">.</span>Response<span class="token punctuation">.</span>StatusCode <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>HttpStatusCode<span class="token punctuation">.</span>InternalServerError<span class="token punctuation">;</span>
        
        <span class="token comment">//标记已处理</span>
        context<span class="token punctuation">.</span>ExceptionHandled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Startup.cs的ConfigureServices中注册filter</span>
services<span class="token punctuation">.</span><span class="token function">AddMvc</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span> options<span class="token punctuation">.</span>Filters<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Add</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>GlobalExceptionFilter<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>此项目采用Asp.Net Core技术栈，引用的Exceptionless包为<code>Exceptionless.AspNetCore</code>,UnhandledException通过对filter进行处理。其它类型的项目可以引用对应的nuget包，作相应的UnhandledException处理即可。</p> <h5 id="_2-日记记录"><a href="#_2-日记记录" class="header-anchor">#</a> 2) 日记记录</h5> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">RequestAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> url<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> parameter<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> method<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 执行网络请求</span>
        <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        ExceptionlessUtil<span class="token punctuation">.</span><span class="token function">Warn</span><span class="token punctuation">(</span>ex<span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">$&quot;网络请求出错</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">url</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="_5-本地部署"><a href="#_5-本地部署" class="header-anchor">#</a> 5. 本地部署</h2> <p>如果不想使用Exceptionless官网提供服务，也可以在本地部署服务器。部署步骤参考 https://github.com/exceptionless/Exceptionless/wiki/Self-Hosting</p> <blockquote><p>Exceptionless 官方文档 https://github.com/exceptionless/Exceptionless/wiki/Getting-Started</p></blockquote></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/26/2021, 2:25:24 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/dotnet/log/elk.html" class="prev">
        ELK
      </a></span> <span class="next"><a href="/dotnet/hosting/hosted_service.html">
        承载系统
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/dotnet/assets/js/app.4e9b76c2.js" defer></script><script src="/dotnet/assets/js/2.86915a18.js" defer></script><script src="/dotnet/assets/js/46.527ac987.js" defer></script>
  </body>
</html>
